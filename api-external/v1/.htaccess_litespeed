# .htaccess otimizado para LiteSpeed
RewriteEngine On

# Permitir OPTIONS para CORS
RewriteCond %{REQUEST_METHOD} ^OPTIONS
RewriteRule ^(.*)$ - [R=200,L]

# Não reescrever se arquivo existe
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^ - [L]

# Não reescrever se diretório existe  
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Redirecionar tudo para index.php preservando PATH_INFO
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ index.php/$1 [QSA,L]

# Headers CORS
<IfModule mod_headers.c>
    Header always set Access-Control-Allow-Origin "*"
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-API-Key"
    Header always set Access-Control-Max-Age "3600"
</IfModule>

# Configurações PHP para LiteSpeed
<IfModule mod_php8.c>
    php_flag display_errors Off
    php_value max_execution_time 60
    php_value memory_limit 256M
</IfModule>

# Proteger arquivos sensíveis
<Files "*.log">
    Order Allow,Deny  
    Deny from all
</Files>

<Files "config/*">
    Order Allow,Deny
    Deny from all
</Files>

# Permitir acesso aos testes
<Files "test_*.php">
    Order Allow,Deny
    Allow from all
</Files>